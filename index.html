<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>نظام عبدالكريم للحسابات</title>
  <style>
    body { font-family: sans-serif; background:#f9f9f9; direction:rtl; padding:20px; }
    input { padding:8px; margin:5px; }
    button { padding:8px 12px; background:#0078D7; color:white; border:none; border-radius:5px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { border:1px solid #ddd; padding:8px; text-align:right; }
  </style>
</head>
<body onload="checkLogin()">
  <h1>📘 نظام عبدالكريم للحسابات</h1>
  <button onclick="logout()" style="background:red;">خروج</button>
  <div>
    <input id="name" placeholder="اسم الزبون">
    <input id="amount" placeholder="المبلغ">
    <input id="date" type="date">
    <button onclick="addInvoice()">إضافة</button>
  </div>

  <table>
    <thead>
      <tr><th>الاسم</th><th>المبلغ</th><th>التاريخ</th></tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <script>
    const API = "https://abdulkarim-accounts.onrender.com";
    function checkLogin(){
      if(localStorage.getItem("loggedIn")!=="true"){
        window.location.href = "login.html";
      }
      loadInvoices();
    }
    function logout(){
      localStorage.removeItem("loggedIn");
      window.location.href = "login.html";
    }
    async function addInvoice(){
      const name = document.getElementById("name").value;
      const amount = document.getElementById("amount").value;
      const date = document.getElementById("date").value;
      await fetch(API+"/add-invoice", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ name, amount, date })
      });
      loadInvoices();
    }
    async function loadInvoices(){
      const res = await fetch(API+"/invoices");
      const data = await res.json();
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";
      data.forEach(inv=>{
        tbody.innerHTML += `<tr><td>${inv.name}</td><td>${inv.amount}</td><td>${inv.date}</td></tr>`;
      });
    }
  </script>
</body>
</html>
